<script>
  function findMax(list, keys) {
    return keys.reduce((acc, key) => {
      const keyMax = list.reduce((acc, item) => item[key] > acc ? item[key] : acc, 0);
      return keyMax > acc ? keyMax : acc;
    }, 0);
  }

  function addBar(list, max, key, outKey) {
    if (max == null) {
      max = findMax(list, [key]);
    }

    // Add pct
    list.forEach(item => {
      item[outKey] = item[key] / max * 100;
    });
  }

  function addRankChange(list, rank1, rank2, outKey) {
    list.forEach(item => {
      item[outKey] = item[rank1] - item[rank2];
    });
  }

  function preprocess() {
    this.today.forEach(s => {
      s.avgPlays = Math.round(s.avgPlays);
    });
    this.all.forEach(s => {
      s.avgPlays = Math.round(s.avgPlays);
    });
  }
</script>